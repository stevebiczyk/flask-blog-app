{% extends 'base.html' %} {% block title %}Login - My Blog Page{% endblock %} {%
block content %}
<div class="form-container">
  <h2>Login</h2>

  <form id="loginForm">
    <div class="form-group">
      <label for="username">Username:</label>
      <input type="text" id="username" name="username" required />
    </div>
    <div class="form-group">
      <label for="password">Password:</label>
      <input type="password" id="password" name="password" required />
    </div>
    <button type="submit">Login</button>
  </form>
  <div id="message"></div>
  <p style="margin-top: 1rem">
    Don't have an account? <a href="/register">Register here</a>.
  </p>
</div>

<script>
  document
    .getElementById("loginForm")
    .addEventListener("submit", async function (e) {
      e.preventDefault();

      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      try {
        const response = await fetch("/api/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ username, password }),
        });

        const data = await response.json();
        const messageDiv = document.getElementById("message");

        if (response.ok) {
          messageDiv.innerHTML = '<p class="success">' + data.message + "</p>";
          // Redirect to home after a 1 second delay
          setTimeout(() => {
            window.location.href = "/";
          }, 1000);
        } else {
          messageDiv.innerHTML = '<p class="error">' + data.error + "</p>";
        }
      } catch (error) {
        document.getElementById("message").innerHTML =
          '<p class="error">An error occurred. Please try again.</p>';
      }
    });
</script>
{% endblock %}
